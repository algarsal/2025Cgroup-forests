---
title: "05_Anova"
format: html

---
```{r}
load("Data/foret.Rdata")
 
library(stringr)
foret$genus <- word(foret$Species, 1)

```




```{r}
#ANOVA for species and genus 
aov2 <- aov(leaf.thick~For.type+Species, data = foret)
aov3 <- aov(leaf.thick~For.type+genus, data = foret)
summary(aov2)
summary(aov3)



AIC(aov2,aov3)
BIC(aov2,aov3)
```



```{r}
#For loop for ANOVA

responses <- c("For.type", "Species", "Ind.number", "leaf.thick", "leaf.area", "spec.leaf.area", "leaf.dry.mat.cont", "leaf.tissue.dens", "twig.dry.mat.cont", "twig.tis.dens", "bark.thick", "bark.dry.mat.cont", "bark.tis.dens", "stem.dry.mat.cont", "stem.tis.dens", "leaf.C.cont", "leaf.N.cont", "leaf.P.cont", "leaf.C.N.ratio", "leaf.C.P.ratio", "leaf.N.P.ratio", "twig.C.cont", "twig.N.cont", "twig.P.cont", "twig.C.N.ratio", "twig.C.P.ratio", "twig.N.P.ratio", "bark.C.cont", "bark.N.cont", "bark.P.cont", "bark.C.N.ratio", "bark.C.P.ratio", "bark.N.P.ratio", "stem.C.content","stem.N.cont", "stem.P.cont", "stem.C.N.ratio", "stem.C.P.ratio", "stem.N.P.ratio")
# Check for NAs
sapply(foret, function(x) sum(is.na(x)))

# Check for Inf or NaN
sapply(foret, function(x) sum(!is.finite(x)))

#Option 1: remove rows with NA in the specific variable
foret_clean <- foret[!is.na(foret$leaf.thick), ]

# Option 2: remove rows with NA in any of the dependent variables
foret_clean <- foret[complete.cases(foret[, responses]), ]

# Check for NAs
sapply(foret, function(x) sum(is.na(x)))

# Check for Inf or NaN
sapply(foret, function(x) sum(!is.finite(x)))

#Option 1: remove rows with NA in the specific variable
foret_clean <- foret[!is.na(foret$leaf.thick), ]

#Option 2: remove rows with NA in any of the dependent variables
foret_clean <- foret[complete.cases(foret[, responses]), ]


aov2 <- aov(leaf.thick ~ For.type + Species, data = foret_clean )
summary(aov2)


results <- data.frame(
  Trait = responses,
  P_value_ForType = NA,
  P_value_Species = NA
)

# Corrected lines in the For loop for ANOVA

for (var in responses) {

    # Check first if variable exists in the dataset
    if (!(var %in% names(foret_clean))) { # Using foret_clean is better here
        cat("\nSkipping", var, "-- variable not found in dataset.\n")
        next
    }

    # Model 1: Species + Forest Type
    formula1 <- as.formula(paste(var, "~ Species + For.type"))
    # *** FIX HERE: Change 'foret' to 'foret_clean' ***
    model1 <- try(aov(formula1, data = foret_clean), silent = TRUE) 

    # Model 2: Genus + Forest Type
    formula2 <- as.formula(paste(var, "~ genus + For.type"))
    # *** FIX HERE: Change 'foret' to 'foret_clean' ***
    model2 <- try(aov(formula2, data = foret_clean), silent = TRUE) 

    cat("\n==========================================\n")
    cat("ANOVA Results for:", var, "\n")
    cat("==========================================\n")

    # Print Model 1
    cat("\nðŸ“Œ Model 1: Species + For.type\n")
    if (inherits(model1, "try-error")) {
        cat("ERROR for Model 1:", var, "\n")
    } else {
        print(summary(model1))
    }

    # Print Model 2
    cat("\nðŸ“Œ Model 2: genus + For.type\n")
    if (inherits(model2, "try-error")) {
        cat("ERROR for Model 2:", var, "\n")
    } else {
        print(summary(model2))
    }
}


```

```{r}
#Table for ANOVA and BIC

# Create a data frame to store results
Table.aov1.aov2 <- data.frame(
  Trait = c("leaf.thick", "leaf.area", "spec.leaf.area", "leaf.dry.mat.cont", "leaf.tissue.dens", "twig.dry.mat.cont", "twig.tis.dens", "bark.thick", "bark.dry.mat.cont", "bark.tis.dens", "stem.dry.mat.cont", "stem.tis.dens", "leaf.C.cont", "leaf.N.cont", "leaf.P.cont", "leaf.C.N.ratio", "leaf.C.P.ratio", "leaf.N.P.ratio", "twig.C.cont", "twig.N.cont", "twig.P.cont", "twig.C.N.ratio", "twig.C.P.ratio", "twig.N.P.ratio", "bark.C.cont", "bark.N.cont", "bark.P.cont", "bark.C.N.ratio", "bark.C.P.ratio", "bark.N.P.ratio", "stem.C.content","stem.N.cont", "stem.P.cont", "stem.C.N.ratio", "stem.C.P.ratio", "stem.N.P.ratio"),
  P_value_species = NA,
  P_value_genus = NA
)


```

