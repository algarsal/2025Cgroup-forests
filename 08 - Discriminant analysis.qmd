---
title: "08-Discriminant analysis"
format: html
---

```{r library load}
# Load the MASS package for LDA
library(MASS)
library(ggplot2)
library(dplyr)

```

```{r LDA Analysis}
#This creates the lda_model object
lda_model <- lda(
formula = lda_formula,
data = lda_data_clean
)

print(lda_model)
# Predict the Linear Discriminants (LDs) -
lda_predict <- predict(lda_model, lda_data_clean)

```

The Coefficients of Linear Discriminants (LD1)

The magnitude and sign of the coefficients tells that:

Â·Magnitude (Absolute Value): How important the variable is in separating the groups. Larger absolute values mean the variable is a stronger discriminator.

Sign (Positive/Negative): The direction of the relationship. A positive coefficient means that a high value for that trait pushes the sample toward one group (the group with the lower LD score), and a negative coefficient pushes it toward the other (the group with the higher LD score).The most effective features for separating your forest types are:

1.  Bark Phosphorus Content (bark.P.cont): This is the single strongest trait distinguishing the two groups. High bark P content is highly characteristic of Conserved forests.

2.Bark Tissue Density (bark.tis.dens): This is the second strongest trait. High bark density is highly characteristic of Disturbed forests.

The LDA confirms that the difference between Conserved and Disturbed forests is primarily driven by a trade-off between nutrient investment (P content), which dominates the conserved group, and structural traits (Tissue Density), which dominates the disturbed group. The other variables play a much smaller, secondary role in the classification.

```{r data preparation for visualization}
# --- 3. Prepare Data for Visualization ---

# Combine the LD scores and the original grouping variable
lda_plot_data <- data.frame(
  Group = lda_data_clean[[group_variable_name]], 
  LD1 = lda_predict$x[,1] )
# Recalculate intercepts for the vertical lines in the density plot
# This calculates the mean LD1 score for each group.
group_means_ld1 <- as.data.frame(lda_model$means %*% lda_model$scaling[,1])
names(group_means_ld1) <- "LD1_Mean"
group_means_ld1$Group <- rownames(group_means_ld1)

```

```{r LDA Analysis Visualization }
print(
  ggplot(lda_plot_data, aes(x = LD1, fill = Group)) +
    geom_density(alpha = 0.6) +
    # Use the new, clean data frame for the vertical lines (THE FIX)
    geom_vline(
      data = group_means_ld1, 
      aes(xintercept = LD1_Mean, color = Group), 
      linetype = "dashed",
      linewidth = 1 # Use linewidth for thickness
    ) +
    labs(
      title = "Distribution of Samples on Linear Discriminant 1 (LD1) by Forest Type",
      x = "Linear Discriminant 1 Score",
      y = "Density"
    ) +
    theme_minimal()
)


# --- 5. Visualization Option B: Scatter Plot (For 3+ groups) ---

# This runs only if you have more than two groups (i.e., more than one LD)
if (ncol(lda_predict$x) > 1) {
  # Add LD2 to the plot data
  lda_plot_data$LD2 <- lda_predict$x[,2] 
  
  # Calculate the group centroids for LD1 and LD2
  group_centroids_ld12 <- as.data.frame(lda_model$means %*% lda_model$scaling[, 1:2])
  names(group_centroids_ld12) <- c("LD1", "LD2")
  group_centroids_ld12$Group <- rownames(group_centroids_ld12)
  
  print(
    ggplot(lda_plot_data, aes(x = LD1, y = LD2, color = Group, fill = Group)) +
      geom_point(size = 3, alpha = 0.8) +
      stat_ellipse(geom = "polygon", alpha = 0.2, type = "norm") + # Add confidence ellipses
      
      # Add group centroids
      geom_point(data = group_centroids_ld12, shape = 4, size = 6, stroke = 2, color = "black") + 
      geom_text(
        data = group_centroids_ld12, 
        aes(x = LD1, y = LD2, label = Group), 
        size = 5, 
        color = "black", 
        vjust = -1
      ) + 
      
      labs(
        title = "LDA Scatter Plot: Group Separation on LD1 vs LD2",
        x = paste("Linear Discriminant 1 (", round(lda_model$svd[1]^2 / sum(lda_model$svd^2) * 100, 1), "%)", sep=""),
        y = paste("Linear Discriminant 2 (", round(lda_model$svd[2]^2 / sum(lda_model$svd^2) * 100, 1), "%)", sep="")
      ) +
      theme_minimal() +
      coord_fixed() # Ensures axes are scaled equally
  )
}
```

2.  Interpretation of the LDA Density Plot (LD1)

Key Observations: Group Means (Vertical Dashed Lines):

The Conserved forests (red) mean is positioned to the left of zero (in the negative score range).

The Disturbed forests (blue) mean is positioned to the right of zero (in the positive score range).

This confirms the LDA successfully created an axis (LD1) that places the mean of the Conserved group at one end and the mean of the Disturbed group at the other.

Overlap and Separation:

High Overlap: There is a substantial region of overlap where the two density curves intersect (roughly between scores -1.0 and 1.5). This indicates that many individual samples, whether Conserved or Disturbed, have very similar trait combinations and would be difficult to classify correctly based on LD1 alone.

Good Separation at Extremes: The LDA does a very good job of identifying the extreme samples. The tails of the distributions (scores below -2.0 and above 2.5) are distinct.

Samples with a very low LD1 score are almost certainly Conserved forests.

Samples with a very high LD1 score are almost certainly Disturbed forests.

Discriminative Traits: The separation is overwhelmingly driven by a trade-off between bark phosphorus content (favoring Conserved forests) and bark tissue density (favoring Disturbed forests)
